TYPE=TRIGGERS
triggers='CREATE DEFINER=`root`@`localhost` TRIGGER `sdd` BEFORE INSERT ON `my18_pay_temp` FOR EACH ROW My_T_P:BEGIN \ndeclare My_uid DECIMAL(11,2);\ndeclare My_id DECIMAL(11,2);\ndeclare My_n varchar (50) ;\ndeclare My_m DECIMAL(11,2);\n\nset @o_time=NEW.o_time;set @dkind=NEW.dkind;set @O_id=NEW.O_id;set @xingwei=NEW.xingwei;set @M_name=NEW.M_name;set @U_id=NEW.U_id;set @addmoney=NEW.addmoney;set @zhuangtai=NEW.zhuangtai;set @H_fee=NEW.H_fee;set @huikuanren=NEW.huikuanren;set @p_type=NEW.p_type;set @a_money=NEW.a_money;set @b_money=NEW.b_money;set @p_money=NEW.p_money;set @U_name=NEW.U_name;set @Memo=\'My18提示:\';if not exists (select uid,id,username from gygy_member_recharge where rechargeid=@U_id) then leave My_T_P; end if;\n  select uid,id,username into My_uid,My_id,My_n from gygy_member_recharge where rechargeid=@U_id limit 1;set @uid=My_uid;\nset @id=My_id;\nset @n=My_n;\n\nif not exists (select coin from gygy_members where uid=@uid) then leave My_T_P; end if;\n  select coin into My_m from gygy_members where uid=@uid limit 1;set @m=My_m;\n\ninsert into gygy_coin_log (uid,type,playedId,coin,userCoin,fcoin,liqType,actionUID,actionTime,actionIP,info,extfield0,extfield1) values (@uid,0,0,@addmoney+@H_fee,@m+@addmoney+@H_fee,0,1,0,UNIX_TIMESTAMP(),0,\'充值\',@id,@U_id);\nupdate gygy_member_recharge set state=9,rechargeTime=UNIX_TIMESTAMP(),rechargeAmount\n=@addmoney+@H_fee where rechargeid=@U_id;\nupdate gygy_members set coin=@m+@addmoney+@H_fee where uid=@uid;\n\n END'
sql_modes=1342177280
definers='root@localhost'
client_cs_names='utf8'
connection_cl_names='utf8_general_ci'
db_cl_names='gbk_chinese_ci'
